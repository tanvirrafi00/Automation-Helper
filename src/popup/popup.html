<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Automation Framework Manager</title>
  <link rel="stylesheet" href="../../assets/css/popup.css">
</head>

<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <h1>üöÄ Automation Framework Manager</h1>
      <div class="header-controls">
        <button id="themeToggle" class="btn-icon" title="Toggle Dark Mode">üåô</button>
      </div>
      <div class="project-selector">
        <select id="projectSelect">
          <option value="">No Project Selected</option>
        </select>
        <button id="newProjectBtn" class="btn btn-primary">+ New Project</button>
      </div>
    </header>

    <!-- Main Content -->
    <div class="content">
      <!-- Tab Navigation -->
      <nav class="tabs">
        <button class="tab-btn active" data-tab="dashboard">Dashboard</button>
        <button class="tab-btn" data-tab="pageObjects">Page Objects</button>
        <button class="tab-btn" data-tab="tests">Tests</button>
        <button class="tab-btn" data-tab="recorder">Recorder</button>
        <button class="tab-btn" data-tab="export">Export</button>
      </nav>

      <!-- Dashboard Tab -->
      <div class="tab-content active" id="dashboard">
        <div class="dashboard">
          <div class="stat-card">
            <h3>Page Objects</h3>
            <p class="stat-number" id="pageObjectCount">0</p>
          </div>
          <div class="stat-card">
            <h3>Test Specs</h3>
            <p class="stat-number" id="testSpecCount">0</p>
          </div>
          <div class="stat-card">
            <h3>Test Cases</h3>
            <p class="stat-number" id="testCaseCount">0</p>
          </div>
        </div>

        <div class="project-info" id="projectInfo">
          <h3>Project Information</h3>
          <p><strong>Tool:</strong> <span id="projectTool">-</span></p>
          <p><strong>Language:</strong> <span id="projectLanguage">-</span></p>
          <p><strong>Created:</strong> <span id="projectCreated">-</span></p>
          <p><strong>Last Updated:</strong> <span id="projectUpdated">-</span></p>
        </div>

        <div class="workflow-guide"
          style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; margin: 20px 0;">
          <h3 style="margin: 0 0 12px 0; font-size: 18px;">üöÄ Quick Start Workflow</h3>
          <div style="display: grid; gap: 12px;">
            <div
              style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 8px; border-left: 4px solid #fbbf24;">
              <strong>Step 1: Navigate to Your Page</strong>
              <p style="margin: 4px 0 0 0; font-size: 13px; opacity: 0.9;">Open the webpage you want to test (e.g.,
                login page, dashboard)</p>
            </div>
            <div
              style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 8px; border-left: 4px solid #10b981;">
              <strong>Step 2: Create Page Object</strong>
              <p style="margin: 4px 0 0 0; font-size: 13px; opacity: 0.9;">Click "Create Page Object" ‚Üí Enable
                auto-detect ‚Üí Elements captured automatically!</p>
            </div>
            <div
              style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 8px; border-left: 4px solid #3b82f6;">
              <strong>Step 3: Create Test Suite</strong>
              <p style="margin: 4px 0 0 0; font-size: 13px; opacity: 0.9;">Go to Tests tab ‚Üí Create test suite ‚Üí Select
                your Page Object</p>
            </div>
            <div
              style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 8px; border-left: 4px solid #ef4444;">
              <strong>Step 4: Record & Generate</strong>
              <p style="margin: 4px 0 0 0; font-size: 13px; opacity: 0.9;">Recorder tab ‚Üí Select Page & Test ‚Üí Record
                interactions ‚Üí Save code!</p>
            </div>
          </div>
        </div>

        <div class="quick-actions">
          <button class="btn btn-secondary" id="createPageObjectBtn">Create Page Object</button>
          <button class="btn btn-secondary" id="createTestBtn">Create Test</button>
          <button class="btn btn-secondary" id="startRecordingBtn">Start Recording</button>
        </div>
      </div>

      <!-- Page Objects Tab -->
      <div class="tab-content" id="pageObjects">
        <div class="tab-header">
          <h2>Page Objects</h2>
          <input type="text" id="pageSearch" placeholder="Search pages..." class="search-input">
          <button class="btn btn-primary" id="addPageObjectBtn">+ Add Page Object</button>
        </div>
        <div class="page-objects-list" id="pageObjectsList">
          <p class="empty-state">No page objects yet. Create one to get started!</p>
        </div>
      </div>

      <!-- Tests Tab -->
      <div class="tab-content" id="tests">
        <div class="tab-header">
          <h2>Test Specifications</h2>
          <input type="text" id="testSearch" placeholder="Search tests..." class="search-input">
          <button class="btn btn-primary" id="addTestBtn">+ Add Test</button>
        </div>
        <div class="tests-list" id="testsList">
          <p class="empty-state">No tests yet. Create one to get started!</p>
        </div>
      </div>

      <!-- Recorder Tab -->
      <div class="tab-content" id="recorder">
        <div class="recorder-controls">
          <h2>Step Recorder</h2>
          <div class="recorder-settings">
            <label>
              Test Spec: <span style="color: red;">*</span>
              <select id="recorderTestSelect" required>
                <option value="">Select Test Spec</option>
              </select>
              <small style="display: block; color: #666; margin-top: 4px;">Select the test suite to add cases to</small>
            </label>
            <label>
              Test Case: <span style="color: red;">*</span>
              <select id="recorderTestCase" required>
                <option value="">Select or Create Test Case</option>
                <option value="__new__">‚ûï Create New Test Case</option>
              </select>
              <small style="display: block; color: #666; margin-top: 4px;">Select an existing test case or create a new
                one</small>
            </label>
            <label id="newTestCaseNameLabel" style="display:none;">
              New Test Case Name:
              <input type="text" id="newTestCaseName" placeholder="e.g., should login successfully">
              <small style="display: block; color: #666; margin-top: 4px;">Name for this specific test case</small>
            </label>
            <div class="recorder-options">
              <label>
                Annotation:
                <input type="text" id="stepAnnotation" placeholder="@smoke, @critical">
              </label>
              <label>
                Assertion:
                <select id="stepAssertion">
                  <option value="">None</option>
                  <option value="toBeVisible">Visible</option>
                  <option value="toHaveText">Have Text</option>
                  <option value="toBeEnabled">Enabled</option>
                </select>
              </label>
            </div>
          </div>
          <div class="recorder-buttons">
            <button class="btn btn-success" id="startRecBtn">‚è∫ Start Recording</button>
            <button class="btn btn-danger" id="stopRecBtn" disabled>‚èπ Stop Recording</button>
            <button class="btn btn-info" id="replayBtn">‚ñ∂ Replay</button>
            <button class="btn btn-danger" id="stopReplayBtn" style="display:none;">‚èπ Stop Replay</button>
            <button class="btn btn-warning" id="screenshotBtn">üì∑ Screenshot</button>
            <button class="btn btn-secondary" id="clearStepsBtn">üóë Clear Steps</button>
            <button class="btn btn-primary" id="generateCodeBtn" style="display:none;">üíæ Generate & Save Code</button>
          </div>
          <div class="recording-status">
            Status: <span id="recordingStatus">Idle</span>
          </div>
        </div>
        <div class="recorded-steps" id="recordedSteps">
          <div class="steps-header">
            <h3>Recorded Steps</h3>
            <button class="btn btn-success" id="runTestBtn" style="display:none;">‚ñ∂Ô∏è Run Test</button>
            <button class="btn btn-danger" id="cancelTestBtn" style="display:none;">‚èπ Cancel</button>
          </div>
          <ul id="stepsList"></ul>
        </div>

        <!-- Test Results Panel -->
        <div class="test-results-panel" id="resultsPanel" style="display:none;">
          <div class="results-header">
            <h3>Test Results</h3>
            <div class="results-actions">
              <button class="btn btn-secondary btn-sm" id="exportResultsBtn">üì§ Export</button>
              <button class="btn btn-secondary btn-sm" id="closeResultsBtn">‚úï Close</button>
            </div>
          </div>
          <div id="resultsContent" class="results-content">
            <!-- Results will be rendered here -->
          </div>
        </div>

        <div class="generated-code">
          <h3>Generated Code</h3>
          <pre id="generatedCode">// Code will appear here...</pre>
          <button class="btn btn-secondary" id="copyCodeBtn">üìã Copy Code</button>
        </div>
      </div>

      <!-- Export Tab -->
      <div class="tab-content" id="export">
        <h2>Export Project</h2>
        <div class="export-options">
          <div class="export-preview" id="exportPreview">
            <h3>Project Structure</h3>
            <pre id="projectStructure">Select a project to see structure...</pre>
          </div>
          <div class="export-actions">
            <button class="btn btn-primary" id="downloadZipBtn">üì¶ Download as ZIP</button>
            <button class="btn btn-secondary" id="downloadProjectBtn">‚¨á Download Files</button>
            <button class="btn btn-secondary" id="copyAllCodeBtn">üìã Copy All Code</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modals -->

  <!-- New Project Modal -->
  <div class="modal" id="newProjectModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Create New Project</h2>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <label>
          Project Name:
          <input type="text" id="projectName" placeholder="My Automation Project">
        </label>
        <label>
          Tool:
          <select id="projectTool">
            <option value="playwright">Playwright</option>
            <option value="selenium">Selenium</option>
            <option value="webdriverio">WebdriverIO</option>
          </select>
        </label>
        <label>
          Language:
          <select id="projectLanguage">
            <option value="typescript">TypeScript</option>
            <option value="javascript">JavaScript</option>
            <option value="python">Python</option>
            <option value="java">Java</option>
          </select>
        </label>
        <label>
          Template:
          <select id="projectTemplate">
            <option value="default">Default</option>
            <option value="web-form">Web Form</option>
            <option value="dashboard">Dashboard</option>
            <option value="e-commerce">E-commerce</option>
          </select>
        </label>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary modal-cancel">Cancel</button>
        <button class="btn btn-primary" id="createProjectBtn">Create Project</button>
      </div>
    </div>
  </div>

  <!-- New Page Object Modal -->
  <div class="modal" id="newPageObjectModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Create Page Object</h2>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="workflow-instructions"
          style="background: #f0f9ff; border-left: 4px solid #3b82f6; padding: 12px; margin-bottom: 16px; border-radius: 4px;">
          <strong>üìã Recommended Workflow:</strong>
          <ol style="margin: 8px 0 0 0; padding-left: 20px; font-size: 13px;">
            <li>Navigate to the page you want to test (e.g., login page)</li>
            <li>Enter the page name and URL below</li>
            <li>Check "Auto-detect elements" to capture elements from current page</li>
            <li>Click "Create Page Object"</li>
            <li>Elements will be automatically captured and added!</li>
          </ol>
        </div>
        <label>
          Action:
          <select id="pageAction">
            <option value="new">Create New Page Object</option>
            <option value="existing">Append to Existing Page Object</option>
          </select>
        </label>
        <div id="existingPageFields" style="display: none;">
          <label>
            Select Page Object:
            <select id="existingPageSelect">
              <option value="">Select Page Object</option>
            </select>
          </label>
        </div>
        <div id="newPageFields">
          <label>
            Page Name: <span style="color: red;">*</span>
            <input type="text" id="pageName" placeholder="e.g., LoginPage, HomePage" required>
            <small style="display: block; color: #666; margin-top: 4px;">Use PascalCase (e.g., LoginPage,
              DashboardPage)</small>
          </label>
          <label>
            Page URL: <span style="color: red;">*</span>
            <input type="text" id="pageUrl" placeholder="https://example.com/login" required>
            <small style="display: block; color: #666; margin-top: 4px;">The URL of the page you're testing</small>
          </label>
        </div>
        <div class="checkbox-group" style="margin-top: 12px; padding: 12px; background: #f9fafb; border-radius: 6px;">
          <input type="checkbox" id="autoDetectElements" checked>
          <label for="autoDetectElements" style="font-weight: 600;">
            üîç Auto-detect elements on current page
          </label>
          <p style="margin: 8px 0 0 24px; font-size: 12px; color: #666;">
            Automatically capture interactive elements (inputs, buttons, links) from the active tab
          </p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary modal-cancel">Cancel</button>
        <button class="btn btn-primary" id="createPageBtn">Create Page Object</button>
      </div>
    </div>
  </div>

  <!-- New Test Modal -->
  <div class="modal" id="newTestModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Add Test Case</h2>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <label>
          Action:
          <select id="testAction">
            <option value="new">Create New Test Suite</option>
            <option value="existing">Add to Existing Suite</option>
          </select>
        </label>
        <div id="newSuiteFields">
          <label>
            Test Suite Name:
            <input type="text" id="testName" placeholder="LoginTest">
          </label>
          <label>
            Page Object:
            <div id="testPageObject" class="multi-select-container">
              <!-- Checkboxes will be populated here -->
            </div>
            <p class="help-text" style="font-size: 11px; color: #aaa; margin-top: 4px;">Select one or more page objects
            </p>
          </label>
        </div>
        <div id="existingSuiteFields" style="display: none;">
          <label>
            Select Test Suite:
            <select id="existingTestSuite">
              <option value="">Select Suite</option>
            </select>
          </label>
          <label>
            Add Page Objects (Optional):
            <div id="existingSuitePageObject" class="multi-select-container">
              <!-- Checkboxes will be populated here -->
            </div>
            <p class="help-text" style="font-size: 11px; color: #aaa; margin-top: 4px;">Select additional page objects
              to add</p>
          </label>
        </div>
        <label>
          Test Case Name:
          <input type="text" id="testCaseName" placeholder="should login successfully">
        </label>
        <div class="checkbox-group">
          <input type="checkbox" id="isDataDriven">
          <label for="isDataDriven">Data Driven Test</label>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary modal-cancel">Cancel</button>
        <button class="btn btn-primary" id="createTestSpecBtn">Add Test Case</button>
      </div>
    </div>
  </div>

  <!-- Code Viewer Modal -->
  <div class="modal" id="codeViewerModal">
    <div class="modal-content large-modal">
      <div class="modal-header">
        <h2 id="codeViewerTitle">Code Viewer</h2>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <pre id="codeViewerContent" class="code-block"></pre>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary modal-cancel">Close</button>
        <button class="btn btn-primary" id="copyViewerCodeBtn">Copy Code</button>
      </div>
    </div>
  </div>

  <!-- Screenshot Viewer Modal -->
  <div class="modal" id="screenshotModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Screenshot</h2>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <img id="screenshotImage" style="width: 100%; height: auto;" alt="Test Screenshot" />
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary modal-cancel">Close</button>
        <button class="btn btn-primary" id="downloadScreenshotBtn">üíæ Download</button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="../../assets/js/jszip.min.js"></script>
  <script src="../utils/models.js"></script>
  <script src="../utils/codeGenerator.js"></script>
  <script src="../utils/projectManager.js"></script>
  <script src="../utils/dataMigration.js"></script>
  <script src="../utils/browserTestExecutor.js"></script>
  <script src="../utils/stepExecutionTracker.js"></script>
  <script src="../../assets/js/popup.js"></script>
</body>

</html>